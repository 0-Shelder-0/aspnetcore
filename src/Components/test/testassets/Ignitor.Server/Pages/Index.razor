@page "/"
@inject Microsoft.JSInterop.IJSRuntime JSRuntime
@using System.Security.Cryptography;
@namespace BasicTestApp
<h1>Counter</h1>

<p>Current count: @currentCount</p>
<p id="errormessage">Error = @error</p>
<button id="triggerjsinterop" @onclick="@TriggerJSInterop">Trigger JS interop</button>

<button id="thecounter" @onclick="@IncrementCount">Click me</button>

<button id="expensiveComputationsDisabled" @onclick="@EnableExpensiveComputations">Enable expensive computations</button>

<input id="boundTextInput" type="text" @bind="@theText" />

@if (!expensiveComputationsDisabled)
{
    <p>Expensive field to compute = @ComputeExpensiveField()</p>
}

@code {
    int currentCount = 0;
    string error = "";
    string theText = "";
    bool expensiveComputationsDisabled = true;
    byte[] dataHolder = new byte[1024 * 1024];
    RandomNumberGenerator rnd = RandomNumberGenerator.Create();

    void IncrementCount()
    {
        currentCount++;
    }

    void EnableExpensiveComputations()
    {
        expensiveComputationsDisabled = false;
    }

    async Task TriggerJSInterop()
    {
        try
        {
            var result = await JSRuntime.InvokeAsync<int>("sendMalformedCallbackReturn", Array.Empty<object>());
        }
        catch (Exception e)
        {
            error = e.Message;
        }
    }

    public string ComputeExpensiveField()
    {
        rnd.GetBytes(dataHolder);
        return Convert.ToBase64String(dataHolder);
    }
}
