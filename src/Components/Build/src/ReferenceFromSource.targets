<Project>

  <!--
    Since this assembly isn't in a shipping package (it's only used when building .Components etc.)
    we can load the assembly directly from its output location in this repo. We don't need to support
    loading this task via some build\tfm\assemblyname.props file as we would if it was a NuGet package.
  -->

  <PropertyGroup>
    <_ComponentsTasksTFM Condition="'$(MSBuildRuntimeType)' == 'Core'">netcoreapp</_ComponentsTasksTFM>
    <_ComponentsTasksTFM Condition="'$(MSBuildRuntimeType)' != 'Core'">netfx</_ComponentsTasksTFM>
    <ComponentsTasksPath>$(OutDir)bin\$(Configuration)\tools\$(_ComponentsTasksTFM)\Microsoft.AspNetCore.Components.Build.Tasks.dll</ComponentsTasksPath>
  </PropertyGroup>

  <ItemGroup>
    <!-- This reference is to enforce the build order only -->
    <ProjectReference
      Include="$(RepoRoot)src\Components\Build\src\Microsoft.AspNetCore.Components.Build.csproj"
      ReferenceOutputAssemblies="false"
      SkipGetTargetFrameworkProperties="true"
      UndefineProperties="TargetFramework"
      Condition="'$(BuildingInsideVisualStudio)' != 'true'" />
  </ItemGroup>

  <UsingTask TaskName="ValidateEmbeddedLinkerConfig" AssemblyFile="$(ComponentsTasksPath)" />

  <Target Name="GenerateComponentsLinkerDescriptorFile" AfterTargets="CoreBuild" Condition="'$(GenerateComponentsLinkerDescriptor)' == 'true'">
    <ValidateEmbeddedLinkerConfig AssemblyPath="@(TargetPathWithTargetPlatformMoniker)" />
  </Target>

</Project>
